#!/usr/bin/env bash

# last line of file needs to be empty
filename=./excludes_tomcat.txt
while read -r line; do
    excluded="$excluded -excludes $line"
done < "$filename"

if [ "$1" = "select" ]; then
  ./peass select -folder ../tomcat/ -startversion 6cf20b4a83f1e5b2ae86525b6b96389e801776b2 -endversion b1ca09f34d0c22727bb5082053c7ae23c30ec8f2  \
  -testExecutor de.dagere.peass.execution.ant.AntTestExecutor -testTransformer de.dagere.peass.testtransformation.JUnitTestTransformer -classFolder java \
  -testClassFolder test -traceSizeInMb 1000 $excluded
elif [ "$1" = "measure" ]; then
  ./peass measure -executionfile results/execute_tomcat.json -folder ../tomcat -vms 5 -iterations 40 -warmup 10 -repetitions 30 \
  -startversion 6cf20b4a83f1e5b2ae86525b6b96389e801776b2 -endversion b1ca09f34d0c22727bb5082053c7ae23c30ec8f2  \
  -testExecutor de.dagere.peass.execution.ant.AntTestExecutor -testTransformer de.dagere.peass.testtransformation.JUnitTestTransformer -classFolder java \
  -testClassFolder test -measurementStrategy PARALLEL -timeout 20
  ./peass getchanges -data ../tomcat_peass/ -dependencyfile results/deps_tomcat.json
elif [ "$1" = "searchcause" ]; then
   ./peass searchcause -vms 5 -iterations 40 -warmup 10 -repetitions 30 -version b1ca09f34d0c22727bb5082053c7ae23c30ec8f2  \
   -test org.apache.catalina.core.TestApplicationSessionCookieConfig\#testSetDomainInitPhase -folder ../tomcat -executionfile results/execute_tomcat.json \
   -testExecutor de.dagere.peass.execution.ant.AntTestExecutor -testTransformer de.dagere.peass.testtransformation.JUnitTestTransformer -classFolder java \
   -testClassFolder test -timeout 20 -traceSizeInMb 1000
elif [ "$1" = "visualizerca" ]; then
  ./peass visualizerca -data ../tomcat_peass/ -propertyFolder results/properties_tomcat/
fi